---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
options(digits = 3)
```

# hypothesize

A consistent API for hypothesis testing in R, designed around principles from
*Structure and Interpretation of Computer Programs* (SICP):
- **Data Abstraction**: Tests are objects with a clean accessor interface
- **Closure Property**: Combining tests yields tests
- **Higher-Order Functions**: Transform tests into new tests

## Installation

```r
# install.packages("devtools")
devtools::install_github("queelius/hypothesize")
```

```{r, echo=FALSE}
library(hypothesize)
```

## The Interface

Every hypothesis test implements the same generic methods:

```{r}
# Create a Wald test
w <- wald_test(estimate = 2.5, se = 0.8, null_value = 0)

pval(w)                    # p-value
test_stat(w)               # test statistic
dof(w)                     # degrees of freedom
is_significant_at(w, 0.05) # significance check
```

## Primitive Tests

### Z-Test (simplest case)

```{r}
# Test if population mean equals 100 (known sigma = 15)
set.seed(42)
x <- rnorm(30, mean = 105, sd = 15)
z_test(x, mu0 = 100, sigma = 15)
```

### Wald Test (general parameters)

```{r}
# Test if a regression coefficient equals zero
wald_test(estimate = 1.8, se = 0.7)
```

### Likelihood Ratio Test (model comparison)

```{r}
# Compare nested models
lrt(null_loglik = -150, alt_loglik = -140, dof = 3)
```

## Combining Tests (Closure Property)

Fisher's method combines independent p-values—and returns a hypothesis test:
```{r}
# Three studies, none individually significant
fisher_combine(0.08, 0.12, 0.06)
```

## Transforming Tests (Higher-Order Functions)

Adjust p-values for multiple testing:

```{r}
tests <- list(
  wald_test(estimate = 2.5, se = 1.0),
  wald_test(estimate = 1.8, se = 0.9),
  wald_test(estimate = 1.2, se = 0.7)
)

# Original p-values
sapply(tests, pval)

# Bonferroni-adjusted
sapply(adjust_pval(tests, method = "bonferroni"), pval)
```

## Duality: Tests ↔ Confidence Intervals

```{r}
w <- wald_test(estimate = 5.0, se = 1.2)
confint(w)
confint(w, level = 0.99)
```

## Extending the Package

Create new test types by calling `hypothesis_test()`:

```{r}
# Custom chi-squared goodness-of-fit wrapper
chisq_gof <- function(observed, expected) {
  stat <- sum((observed - expected)^2 / expected)
  df <- length(observed) - 1
  hypothesis_test(
    stat = stat,
    p.value = pchisq(stat, df, lower.tail = FALSE),
    dof = df,
    superclasses = "chisq_gof_test"
  )
}

chisq_gof(observed = c(45, 35, 20), expected = c(40, 40, 20))
```

## Learn More
See `vignette("introduction", package = "hypothesize")` for a full tutorial.
